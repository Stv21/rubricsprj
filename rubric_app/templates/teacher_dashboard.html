</html>
{% extends 'base.html' %}
{% block title %}Teacher Dashboard{% endblock %}
{% block content %}
{% load static %}
<head>
    <!--- css -->
<link rel="stylesheet" href = "{% static 'css/styles.css' %}">
</head>
<body>

<h1 class="dashboard-title">Teacher Dashboard</h1>

<!-- Button to Create Classroom -->
<div class="create-classroom-container">
    <button id="createClassroomBtn" class="btn btn-primary">Create Classroom</button>
</div>

<!-- Classroom List -->
<div class="classroom-container">
    {% for classroom in classrooms %}
        <div class="classroom-box">
            <h3>{{ classroom.name }}</h3>
            <p>Subject: {{ classroom.subject }}</p>
            <p>Classroom Code: <strong>{{ classroom.code }}</strong></p>

            <!-- View Details -->
            <a href="{% url 'view_classroom' classroom.id %}" class="btn btn-secondary">View Details</a>

            <!-- Delete Classroom -->
            <form method="POST" action="{% url 'delete_classroom' classroom.id %}" class="delete-form">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">Delete Classroom</button>
            </form>

            <!-- Enrolled Students Button -->
            <button class="btn btn-info show-enrolled" data-classroom="{{ classroom.id }}">Enrolled Students</button>
        </div>
    {% empty %}
        <p>No classrooms created yet.</p>
    {% endfor %}
</div>

<!-- Modal for Enrolled Students -->
<div id="enrolledStudentsModal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3>Enrolled Students</h3>
        <ul id="enrolled-students-list"></ul>
    </div>
</div>

<!-- Modal for Creating Classroom -->
<div id="createClassroomModal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3>Create a New Classroom</h3>
        <form method="POST">
            {% csrf_token %}
            {{ create_form.as_p }}
            <button type="submit" class="btn btn-success">Submit</button>
        </form>
    </div>
</div>

<!-- Success and Error Messages -->
{% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div class="alert alert-info">{{ message }}</div>
        {% endfor %}
    </div>
{% endif %}

<!-- CSS -->
<style>
    
    /* Dashboard Title */
    .dashboard-title {
        text-align: center;
        margin-bottom: 20px;
        font-size: 28px;
        color: #333;
    }

    /* Classroom Container */
    .classroom-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
    }

    .classroom-box {
        background-color: #f7f9fc;
        border: 1px solid #ddd;
        padding: 15px;
        border-radius: 8px;
        width: 220px;
        text-align: center;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        position: relative;
    }

    .classroom-box h3 {
        margin-top: 0;
    }

    .btn {
        display: block;
        margin: 10px auto;
        padding: 10px;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
    }

    .btn-primary {
        background-color: #007bff;
        color: white;
    }

    .btn-secondary {
        background-color: #6c757d;
        color: white;
    }

    .btn-danger {
        background-color: #dc3545;
        color: white;
    }

    .btn-info {
        background-color: #17a2b8;
        color: white;
    }

    .btn:hover {
        opacity: 0.9;
    }

    .create-classroom-container {
        text-align: center;
        margin-bottom: 20px;
    }

    /* Modal Styling */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background-color: white;
        margin: 10% auto;
        padding: 20px;
        border-radius: 8px;
        width: 400px;
        text-align: center;
    }

    .close-modal {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 20px;
        cursor: pointer;
    }
</style>

<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Open and close modal for creating a classroom
        $('#createClassroomBtn').click(function () {
            $('#createClassroomModal').fadeIn();
        });
        $('.close-modal').click(function () {
            $('.modal').fadeOut();
        });

        // Open modal to show enrolled students
        $('.show-enrolled').click(function () {
            const classroomId = $(this).data('classroom');
            $.ajax({
                url: `/get_enrolled_students/${classroomId}/`, // Endpoint to fetch enrolled students
                method: 'GET',
                success: function (data) {
                    const studentsList = $('#enrolled-students-list');
                    studentsList.empty();
                    if (data.students.length > 0) {
                        data.students.forEach(student => {
                            studentsList.append(`<li>${student}</li>`);
                        });
                    } else {
                        studentsList.append('<li>No students enrolled.</li>');
                    }
                    $('#enrolledStudentsModal').fadeIn();
                },
                error: function () {
                    alert('Failed to load enrolled students.');
                }
            });
        });

        // Close enrolled students modal
        $('.close-modal').click(function () {
            $('#enrolledStudentsModal').fadeOut();
        });
    });
</script>
</body>
{% endblock %}
</html>
